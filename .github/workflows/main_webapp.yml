# Build & deploy Python Flask Web App to Azure App Service ‚Äî pa200-hw3-webapp
name: Deploy Flask WebApp - pa200-hw3-webapp

on:
  push:
    branches: [main]
  workflow_dispatch:

env:
  PYTHON_VERSION: '3.11'

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read

    steps:
      - uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: ${{ env.PYTHON_VERSION }}

      # (voliteln√©) jednoduch√° syntaktick√° kontrola
      - name: Lint
        run: python -m py_compile webapp/*.py

      # üì¶ 1) vytvo≈ô√≠me ZIP **uvnit≈ô** slo≈æky webapp (bez vno≈ôen√© podslo≈æky)
      - name: Zip artifact for deployment
        run: |
          cd webapp
          zip -r ../webapp.zip .          # ko≈ôen ZIPu = app.py, requirements.txt, ‚Ä¶

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: webapp-zip
          path: webapp.zip

  deploy:
    runs-on: ubuntu-latest
    needs: build

    steps:
      - name: Download artifact
        uses: actions/download-artifact@v4
        with:
          name: webapp-zip

      # üöÄ nasazen√≠ ZIPu p≈ôes publish profile
      - name: Deploy to Azure Web App
        uses: azure/webapps-deploy@v2
        with:
          app-name: 'pa200-hw3-webapp'                      # p≈ôesn√Ω n√°zev v Azure
          publish-profile: ${{ secrets.PHOTO_WEB_PUBLISH_PROFILE }}
          package: webapp.zip                               # ‚Üê ZIP s ploch√Ωm ko≈ôenem
